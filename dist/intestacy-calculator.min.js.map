{"version":3,"file":"intestacy-calculator.min.js","sources":["../src/core/IntestacyCalculator.js","../src/ui/IntestacyUI.js","../src/core/ValidationUtils.js","../src/integration/IntestacyWidget.js"],"sourcesContent":["/**\r\n * IntestacyCalculator.js\r\n * Core logic for the UK intestacy calculator\r\n */\r\n\r\nclass IntestacyCalculator {\r\n  constructor() {\r\n    // Updated to the latest statutory legacy amount\r\n    this.STATUTORY_LEGACY = 322000.00;\r\n    \r\n    // Initialize state\r\n    this.state = {\r\n      name: null,\r\n      estateValue: null,\r\n      married: null,\r\n      children: null,\r\n      grandchildren: null,\r\n      greatGrandchildren: null,\r\n      parentsAlive: null,\r\n      siblings: null,\r\n      fullSiblings: null,\r\n      halfSiblings: null,\r\n      grandparents: null,\r\n      auntsUncles: null,\r\n      fullAuntsUncles: null,\r\n      halfAuntsUncles: null,\r\n      currentQuestion: 0,\r\n      childrenDeceased: null,\r\n      deceasedChildrenHadChildren: null,\r\n      siblingsDeceasedWithChildren: null,\r\n      auntsUnclesDeceasedWithChildren: null\r\n    };\r\n    \r\n    // Define questions\r\n    this.questions = [\r\n      { id: \"married\", text: \"Are you married or in a civil partnership?\" },\r\n      { id: \"children\", text: \"Do you have any children?\" },\r\n      { id: \"childrenDeceased\", text: \"Are any of your children deceased?\" },\r\n      { id: \"deceasedChildrenHadChildren\", text: \"Did any of your deceased children have children of their own?\" },\r\n      { id: \"parentsAlive\", text: \"Are either of your parents alive?\" },\r\n      { id: \"siblings\", text: \"Do you have any siblings?\" },\r\n      { id: \"fullSiblings\", text: \"Do you have any full siblings (same two parents)?\" },\r\n      { id: \"siblingsDeceasedWithChildren\", text: \"Are any of your siblings deceased with children of their own?\" },\r\n      { id: \"halfSiblings\", text: \"Do you have any half siblings (one shared parent)?\" },\r\n      { id: \"grandchildren\", text: \"Do you have any grandchildren?\" },\r\n      { id: \"greatGrandchildren\", text: \"Do you have any great-grandchildren?\" },\r\n      { id: \"grandparents\", text: \"Do you have any living grandparents?\" },\r\n      { id: \"auntsUncles\", text: \"Do you have any living aunts or uncles?\" },\r\n      { id: \"fullAuntsUncles\", text: \"Do you have any full aunts or uncles (siblings of your parents)?\" },\r\n      { id: \"auntsUnclesDeceasedWithChildren\", text: \"Are any of your aunts or uncles deceased with children of their own?\" },\r\n      { id: \"halfAuntsUncles\", text: \"Do you have any half aunts or uncles (half-siblings of your parents)?\" }\r\n    ];\r\n    \r\n    // Create a lookup for questions by ID\r\n    this.questionMap = this.createQuestionMap();\r\n    \r\n    // Define the question flow logic\r\n    this.questionFlow = this.defineQuestionFlow();\r\n  }\r\n  \r\n  /**\r\n   * Create a map of questions by ID for easy lookup\r\n   */\r\n  createQuestionMap() {\r\n    const map = {};\r\n    this.questions.forEach(question => {\r\n      map[question.id] = question;\r\n    });\r\n    return map;\r\n  }\r\n  \r\n  /**\r\n   * Define the question flow logic\r\n   */\r\n  defineQuestionFlow() {\r\n    return {\r\n      \"married\": answer => answer ? \"children\" : \"children\",\r\n      \"children\": answer => answer ? \"childrenDeceased\" : \"parentsAlive\",\r\n      \"childrenDeceased\": answer => answer ? \"deceasedChildrenHadChildren\" : null,\r\n      \"deceasedChildrenHadChildren\": answer => null,\r\n      \"parentsAlive\": answer => answer ? null : \"siblings\",\r\n      \"siblings\": answer => answer ? \"fullSiblings\" : \"grandchildren\",\r\n      \"fullSiblings\": answer => answer ? \"siblingsDeceasedWithChildren\" : \"halfSiblings\",\r\n      \"siblingsDeceasedWithChildren\": answer => null,\r\n      \"halfSiblings\": answer => null,\r\n      \"grandchildren\": answer => answer ? null : \"greatGrandchildren\",\r\n      \"greatGrandchildren\": answer => answer ? null : \"grandparents\",\r\n      \"grandparents\": answer => answer ? null : \"auntsUncles\",\r\n      \"auntsUncles\": answer => answer ? \"fullAuntsUncles\" : null,\r\n      \"fullAuntsUncles\": answer => answer ? \"auntsUnclesDeceasedWithChildren\" : \"halfAuntsUncles\",\r\n      \"auntsUnclesDeceasedWithChildren\": answer => null,\r\n      \"halfAuntsUncles\": answer => null\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Validate the estate value input\r\n   * @param {number} value - The estate value to validate\r\n   * @returns {Object} - Object with isValid and errorMessage properties\r\n   */\r\n  validateEstateValue(value) {\r\n    try {\r\n      if (value === null || value === undefined) {\r\n        return { isValid: false, errorMessage: \"Please enter your estate value\" };\r\n      }\r\n      \r\n      value = parseFloat(value);\r\n      \r\n      if (isNaN(value)) {\r\n        return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n      }\r\n      \r\n      if (value <= 0) {\r\n        return { isValid: false, errorMessage: \"Your estate value must be greater than £0\" };\r\n      }\r\n      \r\n      return { isValid: true, errorMessage: \"\" };\r\n    } catch (error) {\r\n      return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Format amount as currency with £ symbol\r\n   * @param {number} amount - The amount to format\r\n   * @returns {string} - Formatted currency string\r\n   */\r\n  formatCurrency(amount) {\r\n    return new Intl.NumberFormat('en-GB', { \r\n      style: 'currency', \r\n      currency: 'GBP' \r\n    }).format(amount);\r\n  }\r\n  \r\n  /**\r\n   * Calculate the distribution of the estate based on the current state\r\n   * @returns {string} - Description of how the estate will be distributed\r\n   */\r\n  calculateDistribution() {\r\n    const estateValue = parseFloat(this.state.estateValue);\r\n    const formattedValue = this.formatCurrency(estateValue);\r\n    \r\n    // Spouse rules\r\n    if (this.state.married) {\r\n      if (!this.state.children) {\r\n        return `Your entire estate of ${formattedValue} will pass to your spouse/civil partner.`;\r\n      } else {\r\n        if (estateValue <= this.STATUTORY_LEGACY) {\r\n          return `Your entire estate of ${formattedValue} will pass to your spouse/civil partner.`;\r\n        }\r\n        \r\n        const remainder = estateValue - this.STATUTORY_LEGACY;\r\n        const spouseShare = this.STATUTORY_LEGACY + (remainder / 2);\r\n        const childrenShare = remainder / 2;\r\n        \r\n        // Improved text for per stirpes distribution\r\n        const childrenText = !this.state.childrenDeceased \r\n          ? \"children\" \r\n          : \"living children and the children of your deceased children (who will share their parent's portion per stirpes)\";\r\n        \r\n        return (\r\n          `Your estate will be distributed as follows:\\n` +\r\n          `• Your spouse/civil partner will receive: ${this.formatCurrency(spouseShare)}\\n` +\r\n          `  - First ${this.formatCurrency(this.STATUTORY_LEGACY)} as statutory legacy\\n` +\r\n          `  - Plus ${this.formatCurrency(remainder / 2)} (half of the remainder)\\n` +\r\n          `• Your ${childrenText} will share: ${this.formatCurrency(childrenShare)}`\r\n        );\r\n      }\r\n    }\r\n    \r\n    // Non-spouse rules in strict order of precedence\r\n    if (this.state.children) {\r\n      const childrenText = !this.state.childrenDeceased \r\n        ? \"children\" \r\n        : \"living children and the children of your deceased children (who will share their parent's portion per stirpes)\";\r\n      \r\n      return `Your entire estate of ${formattedValue} will be divided equally between your ${childrenText}.`;\r\n    }\r\n    \r\n    if (this.state.parentsAlive) {\r\n      return `Your entire estate of ${formattedValue} will pass to your surviving parent(s) in equal shares.`;\r\n    }\r\n    \r\n    // Improved sibling handling with full vs half distinction\r\n    if (this.state.siblings) {\r\n      if (this.state.fullSiblings) {\r\n        const siblingType = \"full siblings\";\r\n        const childrenText = this.state.siblingsDeceasedWithChildren \r\n          ? \" (their children will inherit their share per stirpes)\" \r\n          : \"\";\r\n        \r\n        return `Your entire estate of ${formattedValue} will be divided equally between your ${siblingType}${childrenText}.`;\r\n      } else if (this.state.halfSiblings) {\r\n        return `Your entire estate of ${formattedValue} will be divided equally between your half-siblings.`;\r\n      }\r\n    }\r\n    \r\n    if (this.state.grandchildren) {\r\n      return `Your entire estate of ${formattedValue} will be divided equally between your grandchildren.`;\r\n    }\r\n    \r\n    if (this.state.greatGrandchildren) {\r\n      return `Your entire estate of ${formattedValue} will be divided equally between your great-grandchildren.`;\r\n    }\r\n    \r\n    if (this.state.grandparents) {\r\n      return `Your entire estate of ${formattedValue} will be divided equally between your grandparents.`;\r\n    }\r\n    \r\n    // Improved aunts/uncles handling with full vs half distinction\r\n    if (this.state.auntsUncles) {\r\n      if (this.state.fullAuntsUncles) {\r\n        const auntsText = \"aunts and uncles\";\r\n        const childrenText = this.state.auntsUnclesDeceasedWithChildren \r\n          ? \" (their children will inherit their share per stirpes)\" \r\n          : \"\";\r\n        \r\n        return `Your entire estate of ${formattedValue} will be divided equally between your ${auntsText}${childrenText}.`;\r\n      } else if (this.state.halfAuntsUncles) {\r\n        return `Your entire estate of ${formattedValue} will be divided equally between your half-aunts and half-uncles.`;\r\n      }\r\n    }\r\n    \r\n    return `Your estate of ${formattedValue} will pass to the Crown (Bona Vacantia).`;\r\n  }\r\n  \r\n  /**\r\n   * Process the user's answer to a specific question and determine the next question\r\n   * @param {string} questionId - The ID of the question being answered\r\n   * @param {boolean} answer - The user's answer (true for Yes, false for No)\r\n   * @returns {string|null} - The ID of the next question to ask, or null if we have enough information\r\n   */\r\n  processAnswer(questionId, answer) {\r\n    // Update the state with the user's answer\r\n    this.state[questionId] = answer;\r\n    \r\n    // Determine the next question based on the flow logic\r\n    if (this.questionFlow[questionId]) {\r\n      const nextQuestionId = this.questionFlow[questionId](answer);\r\n      return nextQuestionId;\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  /**\r\n   * Get the text for a specific question by ID\r\n   * @param {string} questionId - The ID of the question\r\n   * @returns {string} - The question text\r\n   */\r\n  getQuestionText(questionId) {\r\n    if (this.questionMap[questionId]) {\r\n      return this.questionMap[questionId].text;\r\n    }\r\n    return \"Unknown question\";\r\n  }\r\n  \r\n  /**\r\n   * Check if we have enough information to determine distribution\r\n   * @returns {boolean} - True if we can determine distribution, false otherwise\r\n   */\r\n  canDetermineDistribution() {\r\n    if (this.state.married && !this.state.children) {\r\n      return true;\r\n    }\r\n    \r\n    if (this.state.children) {\r\n      return (\r\n        this.state.childrenDeceased !== null && \r\n        (!this.state.childrenDeceased || this.state.deceasedChildrenHadChildren !== null)\r\n      );\r\n    }\r\n    \r\n    // Check the full hierarchy\r\n    return [\r\n      this.state.parentsAlive !== null && this.state.parentsAlive,\r\n      this.state.fullSiblings !== null && this.state.fullSiblings,\r\n      this.state.halfSiblings !== null && this.state.halfSiblings,\r\n      this.state.grandchildren !== null && this.state.grandchildren,\r\n      this.state.greatGrandchildren !== null && this.state.greatGrandchildren,\r\n      this.state.grandparents !== null && this.state.grandparents,\r\n      this.state.fullAuntsUncles !== null && this.state.fullAuntsUncles,\r\n      this.state.halfAuntsUncles !== null && this.state.halfAuntsUncles\r\n    ].some(condition => condition);\r\n  }\r\n}\r\n\r\n// Export the class for use in other modules\r\nexport default IntestacyCalculator;","/**\r\n * IntestacyUI.js\r\n * Main UI controller for the intestacy calculator\r\n */\r\n\r\nimport IntestacyCalculator from '../core/IntestacyCalculator.js';\r\nimport { validateEstateValue, validateName, stringToBoolean } from '../core/ValidationUtils.js';\r\n\r\nclass IntestacyUI {\r\n  /**\r\n   * Create a new IntestacyUI instance\r\n   * @param {HTMLElement|string} container - The container element or selector\r\n   * @param {Object} options - Configuration options\r\n   */\r\n  constructor(container, options = {}) {\r\n    // Get the container element\r\n    this.container = typeof container === 'string' \r\n      ? document.querySelector(container) \r\n      : container;\r\n    \r\n    if (!this.container) {\r\n      throw new Error('Container element not found');\r\n    }\r\n    \r\n    // Default options\r\n    this.options = {\r\n      theme: 'light',\r\n      contactInfo: 'Please contact us to discuss creating a Will.',\r\n      ...options\r\n    };\r\n    \r\n    // Create calculator instance\r\n    this.calculator = new IntestacyCalculator();\r\n    \r\n    // UI state\r\n    this.state = {\r\n      currentStep: 'name',\r\n      questionId: null,\r\n      name: '',\r\n      estateValue: null\r\n    };\r\n    \r\n    // UI elements\r\n    this.elements = {};\r\n    \r\n    // Initialize the UI\r\n    this.init();\r\n  }\r\n  \r\n  /**\r\n   * Initialize the UI\r\n   */\r\n  init() {\r\n    // Create the UI structure\r\n    this.createUIStructure();\r\n    \r\n    // Add event listeners\r\n    this.addEventListeners();\r\n    \r\n    // Apply theme\r\n    this.applyTheme();\r\n    \r\n    // Show the first step (name input)\r\n    this.showNameInput();\r\n  }\r\n  \r\n  /**\r\n   * Create the UI structure\r\n   */\r\n  createUIStructure() {\r\n    // Clear the container\r\n    this.container.innerHTML = '';\r\n    \r\n    // Add CSS class to container\r\n    this.container.classList.add('intestacy-calculator');\r\n    \r\n    // Create header\r\n    const header = document.createElement('div');\r\n    header.className = 'intestacy-header';\r\n    header.innerHTML = `\r\n      <h1>UK Intestacy Calculator</h1>\r\n      <p>Find out how your estate would be distributed if you die without a will</p>\r\n    `;\r\n    this.container.appendChild(header);\r\n    \r\n    // Create main content area\r\n    const content = document.createElement('div');\r\n    content.className = 'intestacy-content';\r\n    this.container.appendChild(content);\r\n    this.elements.content = content;\r\n    \r\n    // Create name input\r\n    const nameSection = document.createElement('div');\r\n    nameSection.className = 'intestacy-section intestacy-name-section';\r\n    nameSection.innerHTML = `\r\n      <label for=\"intestacy-name\">What is your name?</label>\r\n      <input type=\"text\" id=\"intestacy-name\" placeholder=\"Enter your full name\">\r\n      <div class=\"intestacy-error\" id=\"intestacy-name-error\"></div>\r\n    `;\r\n    content.appendChild(nameSection);\r\n    this.elements.nameSection = nameSection;\r\n    this.elements.nameInput = nameSection.querySelector('#intestacy-name');\r\n    this.elements.nameError = nameSection.querySelector('#intestacy-name-error');\r\n    \r\n    // Create estate value input\r\n    const estateSection = document.createElement('div');\r\n    estateSection.className = 'intestacy-section intestacy-estate-section';\r\n    estateSection.innerHTML = `\r\n      <label for=\"intestacy-estate\">What is the approximate value of your estate (£)?</label>\r\n      <input type=\"number\" id=\"intestacy-estate\" placeholder=\"Enter value in pounds\">\r\n      <div class=\"intestacy-error\" id=\"intestacy-estate-error\"></div>\r\n    `;\r\n    content.appendChild(estateSection);\r\n    this.elements.estateSection = estateSection;\r\n    this.elements.estateInput = estateSection.querySelector('#intestacy-estate');\r\n    this.elements.estateError = estateSection.querySelector('#intestacy-estate-error');\r\n    \r\n    // Create status input\r\n    const statusSection = document.createElement('div');\r\n    statusSection.className = 'intestacy-section intestacy-status-section';\r\n    statusSection.innerHTML = `\r\n      <label>What is your relationship status?</label>\r\n      <div class=\"intestacy-radio-group\">\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"single\"> Single\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"married\"> Married/Civil Partnership\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"divorced\"> Divorced\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"widowed\"> Widowed\r\n        </label>\r\n      </div>\r\n    `;\r\n    content.appendChild(statusSection);\r\n    this.elements.statusSection = statusSection;\r\n    this.elements.statusInputs = statusSection.querySelectorAll('input[name=\"intestacy-status\"]');\r\n    \r\n    // Create question section\r\n    const questionSection = document.createElement('div');\r\n    questionSection.className = 'intestacy-section intestacy-question-section';\r\n    questionSection.innerHTML = `\r\n      <div class=\"intestacy-question\" id=\"intestacy-question-text\"></div>\r\n      <div class=\"intestacy-radio-group\">\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-answer\" value=\"Yes\"> Yes\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-answer\" value=\"No\"> No\r\n        </label>\r\n      </div>\r\n    `;\r\n    content.appendChild(questionSection);\r\n    this.elements.questionSection = questionSection;\r\n    this.elements.questionText = questionSection.querySelector('#intestacy-question-text');\r\n    this.elements.answerInputs = questionSection.querySelectorAll('input[name=\"intestacy-answer\"]');\r\n    \r\n    // Create result section\r\n    const resultSection = document.createElement('div');\r\n    resultSection.className = 'intestacy-section intestacy-result-section';\r\n    resultSection.innerHTML = `\r\n      <div class=\"intestacy-result\" id=\"intestacy-result\"></div>\r\n      <div class=\"intestacy-next-steps\">\r\n        <h2>What Next?</h2>\r\n        <p>Having a proper Will is the only way to ensure your estate is distributed according to your wishes.</p>\r\n        <div id=\"intestacy-contact-info\"></div>\r\n      </div>\r\n    `;\r\n    content.appendChild(resultSection);\r\n    this.elements.resultSection = resultSection;\r\n    this.elements.result = resultSection.querySelector('#intestacy-result');\r\n    this.elements.contactInfo = resultSection.querySelector('#intestacy-contact-info');\r\n    \r\n    // Create buttons\r\n    const buttonSection = document.createElement('div');\r\n    buttonSection.className = 'intestacy-buttons';\r\n    buttonSection.innerHTML = `\r\n      <button type=\"button\" id=\"intestacy-continue\">Continue</button>\r\n      <button type=\"button\" id=\"intestacy-restart\">Start Again</button>\r\n    `;\r\n    this.container.appendChild(buttonSection);\r\n    this.elements.continueButton = buttonSection.querySelector('#intestacy-continue');\r\n    this.elements.restartButton = buttonSection.querySelector('#intestacy-restart');\r\n    \r\n    // Create footer\r\n    const footer = document.createElement('div');\r\n    footer.className = 'intestacy-footer';\r\n    footer.innerHTML = `\r\n      <p><strong>Legal Disclaimer:</strong> This calculator provides guidance based on UK intestacy rules. \r\n      For legal advice, please consult a qualified professional.</p>\r\n    `;\r\n    this.container.appendChild(footer);\r\n    \r\n    // Hide sections initially\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n  }\r\n  \r\n  /**\r\n   * Add event listeners to UI elements\r\n   */\r\n  addEventListeners() {\r\n    // Continue button\r\n    this.elements.continueButton.addEventListener('click', () => {\r\n      this.handleContinue();\r\n    });\r\n    \r\n    // Restart button\r\n    this.elements.restartButton.addEventListener('click', () => {\r\n      this.handleRestart();\r\n    });\r\n    \r\n    // Name input enter key\r\n    this.elements.nameInput.addEventListener('keypress', (event) => {\r\n      if (event.key === 'Enter') {\r\n        this.handleContinue();\r\n      }\r\n    });\r\n    \r\n    // Estate input enter key\r\n    this.elements.estateInput.addEventListener('keypress', (event) => {\r\n      if (event.key === 'Enter') {\r\n        this.handleContinue();\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Apply the selected theme\r\n   */\r\n  applyTheme() {\r\n    this.container.classList.add(`intestacy-theme-${this.options.theme}`);\r\n  }\r\n  \r\n  /**\r\n   * Show the name input step\r\n   */\r\n  showNameInput() {\r\n    // Update state\r\n    this.state.currentStep = 'name';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'block';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n    \r\n    // Focus on input\r\n    this.elements.nameInput.focus();\r\n  }\r\n  \r\n  /**\r\n   * Show the estate value input step\r\n   */\r\n  showEstateInput() {\r\n    // Update state\r\n    this.state.currentStep = 'estate';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'block';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n    \r\n    // Focus on input\r\n    this.elements.estateInput.focus();\r\n  }\r\n  \r\n  /**\r\n   * Show the relationship status input step\r\n   */\r\n  showStatusInput() {\r\n    // Update state\r\n    this.state.currentStep = 'status';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'block';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n  }\r\n  \r\n  /**\r\n   * Show a question\r\n   * @param {string} questionId - The ID of the question to show\r\n   */\r\n  showQuestion(questionId) {\r\n    // Update state\r\n    this.state.currentStep = 'question';\r\n    this.state.questionId = questionId;\r\n    \r\n    // Update question text\r\n    this.elements.questionText.textContent = this.calculator.getQuestionText(questionId);\r\n    \r\n    // Clear previous answer\r\n    this.elements.answerInputs.forEach(input => {\r\n      input.checked = false;\r\n    });\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'block';\r\n    this.elements.resultSection.style.display = 'none';\r\n  }\r\n  \r\n  /**\r\n   * Show the result\r\n   */\r\n  showResult() {\r\n    // Calculate distribution\r\n    const resultText = this.calculator.calculateDistribution();\r\n    \r\n    // Format result with name\r\n    const formattedResult = `\r\n      <h2>Distribution Results for ${this.state.name}</h2>\r\n      <p>${resultText}</p>\r\n      <p>If you wish to change this distribution, you will need to create a Will.</p>\r\n    `;\r\n    \r\n    // Update result text\r\n    this.elements.result.innerHTML = formattedResult;\r\n    \r\n    // Update contact info\r\n    this.elements.contactInfo.textContent = this.options.contactInfo;\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'block';\r\n  }\r\n  \r\n  /**\r\n   * Handle the continue button click\r\n   */\r\n  handleContinue() {\r\n    switch (this.state.currentStep) {\r\n      case 'name':\r\n        this.handleNameSubmit();\r\n        break;\r\n      case 'estate':\r\n        this.handleEstateSubmit();\r\n        break;\r\n      case 'status':\r\n        this.handleStatusSubmit();\r\n        break;\r\n      case 'question':\r\n        this.handleQuestionAnswer();\r\n        break;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Handle name input submission\r\n   */\r\n  handleNameSubmit() {\r\n    const name = this.elements.nameInput.value;\r\n    const validation = validateName(name);\r\n    \r\n    if (!validation.isValid) {\r\n      this.elements.nameError.textContent = validation.errorMessage;\r\n      return;\r\n    }\r\n    \r\n    // Clear error\r\n    this.elements.nameError.textContent = '';\r\n    \r\n    // Update state\r\n    this.state.name = name;\r\n    \r\n    // Move to next step\r\n    this.showEstateInput();\r\n  }\r\n  \r\n  /**\r\n   * Handle estate value input submission\r\n   */\r\n  handleEstateSubmit() {\r\n    const estateValue = this.elements.estateInput.value;\r\n    const validation = validateEstateValue(estateValue);\r\n    \r\n    if (!validation.isValid) {\r\n      this.elements.estateError.textContent = validation.errorMessage;\r\n      return;\r\n    }\r\n    \r\n    // Clear error\r\n    this.elements.estateError.textContent = '';\r\n    \r\n    // Update state\r\n    this.state.estateValue = parseFloat(estateValue);\r\n    \r\n    // Move to next step\r\n    this.showStatusInput();\r\n  }\r\n  \r\n  /**\r\n   * Handle relationship status submission\r\n   */\r\n  handleStatusSubmit() {\r\n    let selectedStatus = null;\r\n    \r\n    // Find selected status\r\n    this.elements.statusInputs.forEach(input => {\r\n      if (input.checked) {\r\n        selectedStatus = input.value;\r\n      }\r\n    });\r\n    \r\n    if (!selectedStatus) {\r\n      return; // No status selected\r\n    }\r\n    \r\n    // Update calculator state\r\n    this.calculator.state.name = this.state.name;\r\n    this.calculator.state.estateValue = this.state.estateValue;\r\n    this.calculator.state.married = (selectedStatus === 'married');\r\n    \r\n    // Start the question flow\r\n    this.showQuestion('children');\r\n  }\r\n  \r\n  /**\r\n   * Handle question answer\r\n   */\r\n  handleQuestionAnswer() {\r\n    let selectedAnswer = null;\r\n    \r\n    // Find selected answer\r\n    this.elements.answerInputs.forEach(input => {\r\n      if (input.checked) {\r\n        selectedAnswer = input.value;\r\n      }\r\n    });\r\n    \r\n    if (!selectedAnswer) {\r\n      return; // No answer selected\r\n    }\r\n    \r\n    const questionId = this.state.questionId;\r\n    const isYes = (selectedAnswer === 'Yes');\r\n    \r\n    // Update the calculator state with this answer\r\n    this.calculator.state[questionId] = isYes;\r\n    \r\n    // Process the answer and get the next question\r\n    const nextQuestionId = this.calculator.processAnswer(questionId, isYes);\r\n    \r\n    // If we have a next question, show it\r\n    if (nextQuestionId) {\r\n      this.showQuestion(nextQuestionId);\r\n    } else {\r\n      // Otherwise, we have enough information to show the result\r\n      this.showResult();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Handle restart button click\r\n   */\r\n  handleRestart() {\r\n    // Reset calculator\r\n    this.calculator = new IntestacyCalculator();\r\n    \r\n    // Reset state\r\n    this.state = {\r\n      currentStep: 'name',\r\n      questionId: null,\r\n      name: '',\r\n      estateValue: null\r\n    };\r\n    \r\n    // Reset inputs\r\n    this.elements.nameInput.value = '';\r\n    this.elements.estateInput.value = '';\r\n    this.elements.nameError.textContent = '';\r\n    this.elements.estateError.textContent = '';\r\n    \r\n    this.elements.statusInputs.forEach(input => {\r\n      input.checked = false;\r\n    });\r\n    \r\n    // Show first step\r\n    this.showNameInput();\r\n  }\r\n}\r\n\r\n// Export the class for use in other modules\r\nexport default IntestacyUI;","/**\r\n * ValidationUtils.js\r\n * Utility functions for input validation\r\n */\r\n\r\n/**\r\n * Validate an estate value\r\n * @param {number|string} value - The estate value to validate\r\n * @returns {Object} - Object with isValid and errorMessage properties\r\n */\r\nexport function validateEstateValue(value) {\r\n  try {\r\n    if (value === null || value === undefined || value === '') {\r\n      return { isValid: false, errorMessage: \"Please enter your estate value\" };\r\n    }\r\n    \r\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\r\n    \r\n    if (isNaN(numValue)) {\r\n      return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n    }\r\n    \r\n    if (numValue <= 0) {\r\n      return { isValid: false, errorMessage: \"Your estate value must be greater than £0\" };\r\n    }\r\n    \r\n    return { isValid: true, errorMessage: \"\" };\r\n  } catch (error) {\r\n    return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate a name input\r\n * @param {string} value - The name to validate\r\n * @returns {Object} - Object with isValid and errorMessage properties\r\n */\r\nexport function validateName(value) {\r\n  if (!value || value.trim() === '') {\r\n    return { isValid: false, errorMessage: \"Please enter your name\" };\r\n  }\r\n  \r\n  if (value.trim().length < 2) {\r\n    return { isValid: false, errorMessage: \"Name must be at least 2 characters\" };\r\n  }\r\n  \r\n  return { isValid: true, errorMessage: \"\" };\r\n}\r\n\r\n/**\r\n * Format a number as currency with £ symbol\r\n * @param {number} amount - The amount to format\r\n * @returns {string} - Formatted currency string\r\n */\r\nexport function formatCurrency(amount) {\r\n  return new Intl.NumberFormat('en-GB', { \r\n    style: 'currency', \r\n    currency: 'GBP' \r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Convert a string value to a boolean\r\n * @param {string} value - The value to convert (e.g., \"Yes\", \"No\")\r\n * @returns {boolean|null} - true for \"Yes\", false for \"No\", null for invalid values\r\n */\r\nexport function stringToBoolean(value) {\r\n  if (typeof value === 'boolean') {\r\n    return value;\r\n  }\r\n  \r\n  if (typeof value === 'string') {\r\n    const normalized = value.trim().toLowerCase();\r\n    if (normalized === 'yes' || normalized === 'true' || normalized === '1') {\r\n      return true;\r\n    }\r\n    if (normalized === 'no' || normalized === 'false' || normalized === '0') {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Convert a boolean value to a string\r\n * @param {boolean} value - The boolean value to convert\r\n * @returns {string} - \"Yes\" for true, \"No\" for false\r\n */\r\nexport function booleanToString(value) {\r\n  return value === true ? \"Yes\" : \"No\";\r\n}","/**\r\n * IntestacyWidget.js\r\n * Main widget for embedding the intestacy calculator\r\n */\r\n\r\nimport IntestacyUI from '../ui/IntestacyUI.js';\r\n\r\nclass IntestacyWidget {\r\n  /**\r\n   * Create a new IntestacyWidget instance\r\n   * @param {Object} options - Configuration options\r\n   */\r\n  constructor(options = {}) {\r\n    // Default options\r\n    this.options = {\r\n      container: '#intestacy-calculator',\r\n      theme: 'light',\r\n      contactInfo: 'Please contact us to discuss creating a Will.',\r\n      ...options\r\n    };\r\n    \r\n    // Initialize the widget\r\n    this.init();\r\n  }\r\n  \r\n  /**\r\n   * Initialize the widget\r\n   */\r\n  init() {\r\n    // Ensure styles are loaded\r\n    this.loadStyles();\r\n    \r\n    // Initialize UI\r\n    this.ui = new IntestacyUI(\r\n      this.options.container, \r\n      this.options\r\n    );\r\n  }\r\n  \r\n  /**\r\n   * Load the required styles\r\n   */\r\n  loadStyles() {\r\n    // Check if styles are already loaded\r\n    if (document.getElementById('intestacy-calculator-styles')) {\r\n      return;\r\n    }\r\n    \r\n    // Create style element\r\n    const style = document.createElement('style');\r\n    style.id = 'intestacy-calculator-styles';\r\n    style.textContent = this.getStyles();\r\n    \r\n    // Append to head\r\n    document.head.appendChild(style);\r\n  }\r\n  \r\n  /**\r\n   * Get the CSS styles as a string\r\n   * @returns {string} - CSS styles\r\n   */\r\n  getStyles() {\r\n    return `\r\n      /**\r\n       * Intestacy Calculator Styles\r\n       */\r\n      \r\n      /* Base styles */\r\n      .intestacy-calculator {\r\n        font-family: Arial, sans-serif;\r\n        max-width: 800px;\r\n        margin: 0 auto;\r\n        padding: 20px;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      .intestacy-calculator * {\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      /* Header */\r\n      .intestacy-header {\r\n        margin-bottom: 30px;\r\n        text-align: center;\r\n      }\r\n      \r\n      .intestacy-header h1 {\r\n        font-size: 28px;\r\n        margin: 0 0 10px 0;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-header p {\r\n        font-size: 16px;\r\n        margin: 0;\r\n        color: #666;\r\n      }\r\n      \r\n      /* Content sections */\r\n      .intestacy-content {\r\n        background-color: #f9f9f9;\r\n        border-radius: 8px;\r\n        padding: 20px;\r\n        margin-bottom: 20px;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n      }\r\n      \r\n      .intestacy-section {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      /* Form elements */\r\n      .intestacy-calculator label {\r\n        display: block;\r\n        font-size: 16px;\r\n        font-weight: bold;\r\n        margin-bottom: 8px;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-calculator input[type=\"text\"],\r\n      .intestacy-calculator input[type=\"number\"] {\r\n        width: 100%;\r\n        padding: 10px;\r\n        font-size: 16px;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n        margin-bottom: 5px;\r\n      }\r\n      \r\n      .intestacy-calculator input[type=\"text\"]:focus,\r\n      .intestacy-calculator input[type=\"number\"]:focus {\r\n        border-color: #007bff;\r\n        outline: none;\r\n        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\r\n      }\r\n      \r\n      /* Radio buttons */\r\n      .intestacy-radio-group {\r\n        margin-top: 10px;\r\n      }\r\n      \r\n      .intestacy-radio-group label {\r\n        display: block;\r\n        font-weight: normal;\r\n        margin-bottom: 10px;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .intestacy-radio-group input[type=\"radio\"] {\r\n        margin-right: 8px;\r\n      }\r\n      \r\n      /* Error messages */\r\n      .intestacy-error {\r\n        color: #dc3545;\r\n        font-size: 14px;\r\n        margin-top: 5px;\r\n        min-height: 20px;\r\n      }\r\n      \r\n      /* Question section */\r\n      .intestacy-question {\r\n        font-size: 18px;\r\n        margin-bottom: 15px;\r\n        color: #333;\r\n      }\r\n      \r\n      /* Result section */\r\n      .intestacy-result {\r\n        background-color: #fff;\r\n        padding: 20px;\r\n        border-radius: 5px;\r\n        margin-bottom: 20px;\r\n        border-left: 4px solid #007bff;\r\n      }\r\n      \r\n      .intestacy-result h2 {\r\n        font-size: 22px;\r\n        margin-top: 0;\r\n        margin-bottom: 15px;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-result p {\r\n        margin-bottom: 15px;\r\n        line-height: 1.5;\r\n      }\r\n      \r\n      .intestacy-next-steps {\r\n        margin-top: 20px;\r\n      }\r\n      \r\n      .intestacy-next-steps h2 {\r\n        font-size: 20px;\r\n        margin-top: 0;\r\n        margin-bottom: 10px;\r\n        color: #333;\r\n      }\r\n      \r\n      /* Buttons */\r\n      .intestacy-buttons {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .intestacy-calculator button {\r\n        padding: 10px 20px;\r\n        font-size: 16px;\r\n        border: none;\r\n        border-radius: 4px;\r\n        cursor: pointer;\r\n        transition: background-color 0.2s;\r\n      }\r\n      \r\n      #intestacy-continue {\r\n        background-color: #007bff;\r\n        color: white;\r\n      }\r\n      \r\n      #intestacy-continue:hover {\r\n        background-color: #0069d9;\r\n      }\r\n      \r\n      #intestacy-restart {\r\n        background-color: #6c757d;\r\n        color: white;\r\n      }\r\n      \r\n      #intestacy-restart:hover {\r\n        background-color: #5a6268;\r\n      }\r\n      \r\n      /* Footer */\r\n      .intestacy-footer {\r\n        font-size: 14px;\r\n        color: #666;\r\n        text-align: center;\r\n        margin-top: 30px;\r\n        padding-top: 15px;\r\n        border-top: 1px solid #eee;\r\n      }\r\n      \r\n      /* Light theme (default) */\r\n      .intestacy-theme-light {\r\n        /* Default styles are already light theme */\r\n      }\r\n      \r\n      /* Dark theme */\r\n      .intestacy-theme-dark {\r\n        background-color: #333;\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-header h1 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-header p {\r\n        color: #ccc;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-content {\r\n        background-color: #444;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-calculator label {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-calculator input[type=\"text\"],\r\n      .intestacy-theme-dark .intestacy-calculator input[type=\"number\"] {\r\n        background-color: #555;\r\n        border-color: #666;\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-question {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-result {\r\n        background-color: #555;\r\n        border-left-color: #0d6efd;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-result h2 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-next-steps h2 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-footer {\r\n        color: #ccc;\r\n        border-top-color: #555;\r\n      }\r\n      \r\n      /* Responsive styles */\r\n      @media (max-width: 768px) {\r\n        .intestacy-calculator {\r\n          padding: 15px;\r\n        }\r\n        \r\n        .intestacy-header h1 {\r\n          font-size: 24px;\r\n        }\r\n        \r\n        .intestacy-content {\r\n          padding: 15px;\r\n        }\r\n        \r\n        .intestacy-buttons {\r\n          flex-direction: column;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .intestacy-calculator button {\r\n          width: 100%;\r\n        }\r\n      }\r\n      \r\n      @media (max-width: 480px) {\r\n        .intestacy-header h1 {\r\n          font-size: 22px;\r\n        }\r\n        \r\n        .intestacy-question {\r\n          font-size: 16px;\r\n        }\r\n        \r\n        .intestacy-result h2 {\r\n          font-size: 20px;\r\n        }\r\n      }\r\n    `;\r\n  }\r\n  \r\n  /**\r\n   * Reset the calculator to its initial state\r\n   */\r\n  reset() {\r\n    if (this.ui) {\r\n      this.ui.handleRestart();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Update widget options\r\n   * @param {Object} options - New options to apply\r\n   */\r\n  updateOptions(options = {}) {\r\n    this.options = {\r\n      ...this.options,\r\n      ...options\r\n    };\r\n    \r\n    // Reinitialize with new options\r\n    this.init();\r\n  }\r\n}\r\n\r\n// Make available globally when included via script tag\r\nif (typeof window !== 'undefined') {\r\n  window.IntestacyWidget = IntestacyWidget;\r\n}\r\n\r\nexport default IntestacyWidget;"],"names":["IntestacyCalculator","constructor","this","STATUTORY_LEGACY","state","name","estateValue","married","children","grandchildren","greatGrandchildren","parentsAlive","siblings","fullSiblings","halfSiblings","grandparents","auntsUncles","fullAuntsUncles","halfAuntsUncles","currentQuestion","childrenDeceased","deceasedChildrenHadChildren","siblingsDeceasedWithChildren","auntsUnclesDeceasedWithChildren","questions","id","text","questionMap","createQuestionMap","questionFlow","defineQuestionFlow","map","forEach","question","answer","validateEstateValue","value","isValid","errorMessage","parseFloat","isNaN","error","formatCurrency","amount","Intl","NumberFormat","style","currency","format","calculateDistribution","formattedValue","remainder","spouseShare","childrenShare","childrenText","processAnswer","questionId","getQuestionText","canDetermineDistribution","some","condition","IntestacyUI","container","options","document","querySelector","Error","theme","contactInfo","calculator","currentStep","elements","init","createUIStructure","addEventListeners","applyTheme","showNameInput","innerHTML","classList","add","header","createElement","className","appendChild","content","nameSection","nameInput","nameError","estateSection","estateInput","estateError","statusSection","statusInputs","querySelectorAll","questionSection","questionText","answerInputs","resultSection","result","buttonSection","continueButton","restartButton","footer","display","addEventListener","handleContinue","handleRestart","event","key","focus","showEstateInput","showStatusInput","showQuestion","textContent","input","checked","showResult","resultText","formattedResult","handleNameSubmit","handleEstateSubmit","handleStatusSubmit","handleQuestionAnswer","validation","trim","length","numValue","selectedStatus","selectedAnswer","isYes","nextQuestionId","IntestacyWidget","loadStyles","ui","getElementById","getStyles","head","reset","updateOptions","window"],"mappings":"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"}