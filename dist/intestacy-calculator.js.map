{"version":3,"file":"intestacy-calculator.js","sources":["../src/core/IntestacyCalculator.js","../src/core/ValidationUtils.js","../src/ui/IntestacyUI.js","../src/integration/IntestacyWidget.js"],"sourcesContent":["/**\r\n * IntestacyCalculator.js\r\n * Core logic for the UK intestacy calculator\r\n */\r\n\r\nclass IntestacyCalculator {\r\n  constructor() {\r\n    // Updated to the latest statutory legacy amount\r\n    this.STATUTORY_LEGACY = 322000.00;\r\n    \r\n    // Initialize state\r\n    this.state = {\r\n      name: null,\r\n      estateValue: null,\r\n      married: null,\r\n      cohabiting: null, // New property for cohabiting status\r\n      children: null,\r\n      grandchildren: null,\r\n      greatGrandchildren: null,\r\n      parentsAlive: null,\r\n      siblings: null,\r\n      fullSiblings: null,\r\n      halfSiblings: null,\r\n      grandparents: null,\r\n      auntsUncles: null,\r\n      fullAuntsUncles: null,\r\n      halfAuntsUncles: null,\r\n      currentQuestion: 0,\r\n      childrenDeceased: null,\r\n      deceasedChildrenHadChildren: null,\r\n      siblingsDeceasedWithChildren: null,\r\n      auntsUnclesDeceasedWithChildren: null\r\n    };\r\n    \r\n    // Define questions\r\n    this.questions = [\r\n      { id: \"married\", text: \"Are you married or in a civil partnership?\" },\r\n      { id: \"children\", text: \"Do you have any children?\" },\r\n      { id: \"childrenDeceased\", text: \"Are any of your children deceased?\" },\r\n      { id: \"deceasedChildrenHadChildren\", text: \"Did any of your deceased children have children of their own?\" },\r\n      { id: \"parentsAlive\", text: \"Are either of your parents alive?\" },\r\n      { id: \"siblings\", text: \"Do you have any siblings?\" },\r\n      { id: \"fullSiblings\", text: \"Do you have any full siblings (same two parents)?\" },\r\n      { id: \"siblingsDeceasedWithChildren\", text: \"Are any of your siblings deceased with children of their own?\" },\r\n      { id: \"halfSiblings\", text: \"Do you have any half siblings (one shared parent)?\" },\r\n      { id: \"grandparents\", text: \"Do you have any living grandparents?\" },\r\n      { id: \"auntsUncles\", text: \"Do you have any living aunts or uncles?\" },\r\n      { id: \"fullAuntsUncles\", text: \"Do you have any full aunts or uncles (siblings of your parents)?\" },\r\n      { id: \"auntsUnclesDeceasedWithChildren\", text: \"Are any of your aunts or uncles deceased with children of their own?\" },\r\n      { id: \"halfAuntsUncles\", text: \"Do you have any half aunts or uncles (half-siblings of your parents)?\" }\r\n    ];\r\n    \r\n    // Create a lookup for questions by ID\r\n    this.questionMap = this.createQuestionMap();\r\n    \r\n    // Define the question flow logic\r\n    this.questionFlow = this.defineQuestionFlow();\r\n  }\r\n  \r\n  /**\r\n   * Create a map of questions by ID for easy lookup\r\n   */\r\n  createQuestionMap() {\r\n    const map = {};\r\n    this.questions.forEach(question => {\r\n      map[question.id] = question;\r\n    });\r\n    return map;\r\n  }\r\n  \r\n  /**\r\n   * Define the question flow logic\r\n   */\r\n  defineQuestionFlow() {\r\n    return {\r\n      \"married\": answer => answer ? \"children\" : \"children\",\r\n      \"children\": answer => answer ? \"childrenDeceased\" : \"parentsAlive\",\r\n      \"childrenDeceased\": answer => answer ? \"deceasedChildrenHadChildren\" : null,\r\n      \"deceasedChildrenHadChildren\": answer => null,\r\n      \"parentsAlive\": answer => answer ? null : \"siblings\",\r\n      \"siblings\": answer => answer ? \"fullSiblings\" : \"grandparents\",\r\n      \"fullSiblings\": answer => answer ? \"siblingsDeceasedWithChildren\" : \"halfSiblings\",\r\n      \"siblingsDeceasedWithChildren\": answer => null,\r\n      \"halfSiblings\": answer => null,\r\n      \"grandparents\": answer => answer ? null : \"auntsUncles\",\r\n      \"auntsUncles\": answer => answer ? \"fullAuntsUncles\" : null,\r\n      \"fullAuntsUncles\": answer => answer ? \"auntsUnclesDeceasedWithChildren\" : \"halfAuntsUncles\",\r\n      \"auntsUnclesDeceasedWithChildren\": answer => null,\r\n      \"halfAuntsUncles\": answer => null\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Validate the estate value input\r\n   * @param {number} value - The estate value to validate\r\n   * @returns {Object} - Object with isValid and errorMessage properties\r\n   */\r\n  validateEstateValue(value) {\r\n    try {\r\n      if (value === null || value === undefined) {\r\n        return { isValid: false, errorMessage: \"Please enter your estate value\" };\r\n      }\r\n      \r\n      value = parseFloat(value);\r\n      \r\n      if (isNaN(value)) {\r\n        return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n      }\r\n      \r\n      if (value <= 0) {\r\n        return { isValid: false, errorMessage: \"Your estate value must be greater than £0\" };\r\n      }\r\n      \r\n      return { isValid: true, errorMessage: \"\" };\r\n    } catch (error) {\r\n      return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Format amount as currency with £ symbol\r\n   * @param {number} amount - The amount to format\r\n   * @returns {string} - Formatted currency string\r\n   */\r\n  formatCurrency(amount) {\r\n    return new Intl.NumberFormat('en-GB', { \r\n      style: 'currency', \r\n      currency: 'GBP' \r\n    }).format(amount);\r\n  }\r\n  \r\n  /**\r\n   * Calculate the distribution of the estate based on the current state\r\n   * @returns {string} - Description of how the estate will be distributed\r\n   */\r\n  calculateDistribution() {\r\n    const estateValue = parseFloat(this.state.estateValue);\r\n    const formattedValue = this.formatCurrency(estateValue);\r\n    \r\n    // Cohabiting warning - check this before spouse rules\r\n    if (this.state.cohabiting) {\r\n      return (\r\n        `<div class=\"intestacy-cohabiting-warning\">` +\r\n        `Warning: As a cohabiting partner, you have no automatic inheritance rights under UK law.` +\r\n        `</div>\\n\\n` +\r\n        `Your estate of ${formattedValue} will be distributed as follows:\\n` +\r\n        `• Your cohabiting partner will not automatically inherit anything\\n` +\r\n        `• Your estate will pass to your relatives according to intestacy rules:\\n` +\r\n        this.getInheritanceHierarchyText(estateValue) +\r\n        `\\n\\nTo protect your partner, you should create a valid Will.`\r\n      );\r\n    }\r\n    \r\n    // Spouse rules\r\n    if (this.state.married) {\r\n      if (!this.state.children) {\r\n        return `Your entire estate of ${formattedValue} will pass to your spouse/civil partner.`;\r\n      } else {\r\n        if (estateValue <= this.STATUTORY_LEGACY) {\r\n          return `Your entire estate of ${formattedValue} will pass to your spouse/civil partner.`;\r\n        }\r\n        \r\n        const remainder = estateValue - this.STATUTORY_LEGACY;\r\n        const spouseShare = this.STATUTORY_LEGACY + (remainder / 2);\r\n        const childrenShare = remainder / 2;\r\n        \r\n        // Improved text for per stirpes distribution\r\n        const childrenText = !this.state.childrenDeceased \r\n          ? \"children\" \r\n          : \"living children and the children of your deceased children (who will share their parent's portion per stirpes)\";\r\n        \r\n        return (\r\n          `Your estate will be distributed as follows:\\n` +\r\n          `• Your spouse/civil partner will receive: ${this.formatCurrency(spouseShare)}\\n` +\r\n          `  - First ${this.formatCurrency(this.STATUTORY_LEGACY)} as statutory legacy\\n` +\r\n          `  - Plus ${this.formatCurrency(remainder / 2)} (half of the remainder)\\n` +\r\n          `• Your ${childrenText} will share: ${this.formatCurrency(childrenShare)}`\r\n        );\r\n      }\r\n    }\r\n    \r\n    // Non-spouse rules in strict order of precedence\r\n    if (this.state.children) {\r\n      const childrenText = !this.state.childrenDeceased \r\n        ? \"children\" \r\n        : \"living children and the children of your deceased children (who will share their parent's portion per stirpes)\";\r\n      \r\n      return `Your entire estate of ${formattedValue} will be divided equally between your ${childrenText}.`;\r\n    }\r\n    \r\n    if (this.state.parentsAlive) {\r\n      return `Your entire estate of ${formattedValue} will pass to your surviving parent(s) in equal shares.`;\r\n    }\r\n    \r\n    // Improved sibling handling with full vs half distinction\r\n    if (this.state.siblings) {\r\n      if (this.state.fullSiblings) {\r\n        const siblingType = \"full siblings\";\r\n        const childrenText = this.state.siblingsDeceasedWithChildren \r\n          ? \" (their children will inherit their share per stirpes)\" \r\n          : \"\";\r\n        \r\n        return `Your entire estate of ${formattedValue} will be divided equally between your ${siblingType}${childrenText}.`;\r\n      } else if (this.state.halfSiblings) {\r\n        return `Your entire estate of ${formattedValue} will be divided equally between your half-siblings.`;\r\n      }\r\n    }\r\n    \r\n    if (this.state.grandparents) {\r\n      return `Your entire estate of ${formattedValue} will be divided equally between your grandparents.`;\r\n    }\r\n    \r\n    // Improved aunts/uncles handling with full vs half distinction\r\n    if (this.state.auntsUncles) {\r\n      if (this.state.fullAuntsUncles) {\r\n        const auntsText = \"aunts and uncles\";\r\n        const childrenText = this.state.auntsUnclesDeceasedWithChildren \r\n          ? \" (their children will inherit their share per stirpes)\" \r\n          : \"\";\r\n        \r\n        return `Your entire estate of ${formattedValue} will be divided equally between your ${auntsText}${childrenText}.`;\r\n      } else if (this.state.halfAuntsUncles) {\r\n        return `Your entire estate of ${formattedValue} will be divided equally between your half-aunts and half-uncles.`;\r\n      }\r\n    }\r\n    \r\n    return `Your estate of ${formattedValue} will pass to the Crown (Bona Vacantia).`;\r\n  }\r\n  \r\n  /**\r\n   * Process the user's answer to a specific question and determine the next question\r\n   * @param {string} questionId - The ID of the question being answered\r\n   * @param {boolean} answer - The user's answer (true for Yes, false for No)\r\n   * @returns {string|null} - The ID of the next question to ask, or null if we have enough information\r\n   */\r\n  processAnswer(questionId, answer) {\r\n    // Update the state with the user's answer\r\n    this.state[questionId] = answer;\r\n    \r\n    // Determine the next question based on the flow logic\r\n    if (this.questionFlow[questionId]) {\r\n      const nextQuestionId = this.questionFlow[questionId](answer);\r\n      return nextQuestionId;\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  /**\r\n   * Get the text for a specific question by ID\r\n   * @param {string} questionId - The ID of the question\r\n   * @returns {string} - The question text\r\n   */\r\n  getQuestionText(questionId) {\r\n    if (this.questionMap[questionId]) {\r\n      return this.questionMap[questionId].text;\r\n    }\r\n    return \"Unknown question\";\r\n  }\r\n  \r\n  /**\r\n   * Generate text describing the inheritance hierarchy for cohabiting cases\r\n   * @param {number} estateValue - The value of the estate\r\n   * @returns {string} - Description of how the estate will be distributed\r\n   */\r\n  getInheritanceHierarchyText(estateValue) {\r\n    const formattedValue = this.formatCurrency(estateValue);\r\n    \r\n    if (this.state.children) {\r\n      const childrenText = !this.state.childrenDeceased\r\n        ? \"children\"\r\n        : \"living children and the children of your deceased children (who will share their parent's portion per stirpes)\";\r\n      \r\n      return `  - Your entire estate of ${formattedValue} will be divided equally between your ${childrenText}.`;\r\n    }\r\n    \r\n    if (this.state.parentsAlive) {\r\n      return `  - Your entire estate of ${formattedValue} will pass to your surviving parent(s) in equal shares.`;\r\n    }\r\n    \r\n    if (this.state.siblings) {\r\n      if (this.state.fullSiblings) {\r\n        const siblingType = \"full siblings\";\r\n        const childrenText = this.state.siblingsDeceasedWithChildren\r\n          ? \" (their children will inherit their share per stirpes)\"\r\n          : \"\";\r\n        \r\n        return `  - Your entire estate of ${formattedValue} will be divided equally between your ${siblingType}${childrenText}.`;\r\n      } else if (this.state.halfSiblings) {\r\n        return `  - Your entire estate of ${formattedValue} will be divided equally between your half-siblings.`;\r\n      }\r\n    }\r\n    \r\n    if (this.state.grandparents) {\r\n      return `  - Your entire estate of ${formattedValue} will be divided equally between your grandparents.`;\r\n    }\r\n    \r\n    if (this.state.auntsUncles) {\r\n      if (this.state.fullAuntsUncles) {\r\n        const auntsText = \"aunts and uncles\";\r\n        const childrenText = this.state.auntsUnclesDeceasedWithChildren\r\n          ? \" (their children will inherit their share per stirpes)\"\r\n          : \"\";\r\n        \r\n        return `  - Your entire estate of ${formattedValue} will be divided equally between your ${auntsText}${childrenText}.`;\r\n      } else if (this.state.halfAuntsUncles) {\r\n        return `  - Your entire estate of ${formattedValue} will be divided equally between your half-aunts and half-uncles.`;\r\n      }\r\n    }\r\n    \r\n    return `  - Your estate of ${formattedValue} will pass to the Crown (Bona Vacantia).`;\r\n  }\r\n\r\n  /**\r\n   * Check if we have enough information to determine distribution\r\n   * @returns {boolean} - True if we can determine distribution, false otherwise\r\n   */\r\n  canDetermineDistribution() {\r\n    if (this.state.married && !this.state.children) {\r\n      return true;\r\n    }\r\n    \r\n    if (this.state.children) {\r\n      return (\r\n        this.state.childrenDeceased !== null && \r\n        (!this.state.childrenDeceased || this.state.deceasedChildrenHadChildren !== null)\r\n      );\r\n    }\r\n    \r\n    // Check the full hierarchy\r\n    return [\r\n      this.state.parentsAlive !== null && this.state.parentsAlive,\r\n      this.state.fullSiblings !== null && this.state.fullSiblings,\r\n      this.state.halfSiblings !== null && this.state.halfSiblings,\r\n      this.state.grandparents !== null && this.state.grandparents,\r\n      this.state.fullAuntsUncles !== null && this.state.fullAuntsUncles,\r\n      this.state.halfAuntsUncles !== null && this.state.halfAuntsUncles\r\n    ].some(condition => condition);\r\n  }\r\n}\r\n\r\n// Export the class for use in other modules\r\nexport default IntestacyCalculator;","/**\r\n * ValidationUtils.js\r\n * Utility functions for input validation\r\n */\r\n\r\n/**\r\n * Validate an estate value\r\n * @param {number|string} value - The estate value to validate\r\n * @returns {Object} - Object with isValid and errorMessage properties\r\n */\r\nexport function validateEstateValue(value) {\r\n  try {\r\n    if (value === null || value === undefined || value === '') {\r\n      return { isValid: false, errorMessage: \"Please enter your estate value\" };\r\n    }\r\n    \r\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\r\n    \r\n    if (isNaN(numValue)) {\r\n      return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n    }\r\n    \r\n    if (numValue <= 0) {\r\n      return { isValid: false, errorMessage: \"Your estate value must be greater than £0\" };\r\n    }\r\n    \r\n    return { isValid: true, errorMessage: \"\" };\r\n  } catch (error) {\r\n    return { isValid: false, errorMessage: \"Please enter a valid number\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Validate a name input\r\n * @param {string} value - The name to validate\r\n * @returns {Object} - Object with isValid and errorMessage properties\r\n */\r\nexport function validateName(value) {\r\n  if (!value || value.trim() === '') {\r\n    return { isValid: false, errorMessage: \"Please enter your name\" };\r\n  }\r\n  \r\n  if (value.trim().length < 2) {\r\n    return { isValid: false, errorMessage: \"Name must be at least 2 characters\" };\r\n  }\r\n  \r\n  return { isValid: true, errorMessage: \"\" };\r\n}\r\n\r\n/**\r\n * Format a number as currency with £ symbol\r\n * @param {number} amount - The amount to format\r\n * @returns {string} - Formatted currency string\r\n */\r\nexport function formatCurrency(amount) {\r\n  return new Intl.NumberFormat('en-GB', { \r\n    style: 'currency', \r\n    currency: 'GBP' \r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Convert a string value to a boolean\r\n * @param {string} value - The value to convert (e.g., \"Yes\", \"No\")\r\n * @returns {boolean|null} - true for \"Yes\", false for \"No\", null for invalid values\r\n */\r\nexport function stringToBoolean(value) {\r\n  if (typeof value === 'boolean') {\r\n    return value;\r\n  }\r\n  \r\n  if (typeof value === 'string') {\r\n    const normalized = value.trim().toLowerCase();\r\n    if (normalized === 'yes' || normalized === 'true' || normalized === '1') {\r\n      return true;\r\n    }\r\n    if (normalized === 'no' || normalized === 'false' || normalized === '0') {\r\n      return false;\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Convert a boolean value to a string\r\n * @param {boolean} value - The boolean value to convert\r\n * @returns {string} - \"Yes\" for true, \"No\" for false\r\n */\r\nexport function booleanToString(value) {\r\n  return value === true ? \"Yes\" : \"No\";\r\n}","/**\r\n * IntestacyUI.js\r\n * Main UI controller for the intestacy calculator\r\n */\r\n\r\nimport IntestacyCalculator from '../core/IntestacyCalculator.js';\r\nimport { validateEstateValue, validateName, stringToBoolean } from '../core/ValidationUtils.js';\r\n\r\nclass IntestacyUI {\r\n  /**\r\n   * Create a new IntestacyUI instance\r\n   * @param {HTMLElement|string} container - The container element or selector\r\n   * @param {Object} options - Configuration options\r\n   */\r\n  constructor(container, options = {}) {\r\n    // Get the container element\r\n    this.container = typeof container === 'string' \r\n      ? document.querySelector(container) \r\n      : container;\r\n    \r\n    if (!this.container) {\r\n      throw new Error('Container element not found');\r\n    }\r\n    \r\n    // Default options\r\n    this.options = {\r\n      theme: 'light',\r\n      contactInfo: 'Please contact us to discuss creating a Will.',\r\n      ...options\r\n    };\r\n    \r\n    // Create calculator instance\r\n    this.calculator = new IntestacyCalculator();\r\n    \r\n    // UI state\r\n    this.state = {\r\n      currentStep: 'name',\r\n      questionId: null,\r\n      name: '',\r\n      estateValue: null\r\n    };\r\n    \r\n    // UI elements\r\n    this.elements = {};\r\n    \r\n    // Initialize the UI\r\n    this.init();\r\n  }\r\n  \r\n  /**\r\n   * Initialize the UI\r\n   */\r\n  init() {\r\n    // Create the UI structure\r\n    this.createUIStructure();\r\n    \r\n    // Add event listeners\r\n    this.addEventListeners();\r\n    \r\n    // Apply theme\r\n    this.applyTheme();\r\n    \r\n    // Show the first step (name input)\r\n    this.showNameInput();\r\n  }\r\n  \r\n  /**\r\n   * Create the UI structure\r\n   */\r\n  createUIStructure() {\r\n    // Clear the container\r\n    this.container.innerHTML = '';\r\n    \r\n    // Add CSS class to container\r\n    this.container.classList.add('intestacy-calculator');\r\n    \r\n    // Set contact info\r\n    this.options.contactPhone = this.options.contactPhone || '0123 456 7890';\r\n    this.options.contactEmail = this.options.contactEmail || 'info@example.com';\r\n    \r\n    // Create header\r\n    const header = document.createElement('div');\r\n    header.className = 'intestacy-header';\r\n    header.innerHTML = `\r\n      <h1>UK Intestacy Calculator</h1>\r\n      <p>Find out how your estate would be distributed if you die without a will</p>\r\n    `;\r\n    this.container.appendChild(header);\r\n    \r\n    \r\n    // Create cohabiting warning (hidden by default)\r\n    const cohabitingWarning = document.createElement('div');\r\n    cohabitingWarning.className = 'intestacy-cohabiting-warning';\r\n    cohabitingWarning.style.display = 'none';\r\n    cohabitingWarning.innerHTML = `\r\n      <strong>WARNING:</strong> As a cohabiting partner, you have NO automatic inheritance rights under UK law.\r\n      <p>Your partner will NOT automatically inherit anything from your estate if you die without a will.</p>\r\n      <p>To protect your partner, you should create a valid Will as soon as possible.</p>\r\n      <p class=\"intestacy-contact-highlight\">Contact our firm at <strong>${this.options.contactPhone}</strong> or <strong>${this.options.contactEmail}</strong> to discuss creating a Will.</p>\r\n    `;\r\n    this.container.appendChild(cohabitingWarning);\r\n    this.elements.cohabitingWarning = cohabitingWarning;\r\n    // Create main content area\r\n    const content = document.createElement('div');\r\n    content.className = 'intestacy-content';\r\n    this.container.appendChild(content);\r\n    this.elements.content = content;\r\n    \r\n    // Create name input\r\n    const nameSection = document.createElement('div');\r\n    nameSection.className = 'intestacy-section intestacy-name-section';\r\n    nameSection.innerHTML = `\r\n      <label for=\"intestacy-name\">What is your name?</label>\r\n      <input type=\"text\" id=\"intestacy-name\" placeholder=\"Enter your full name\">\r\n      <div class=\"intestacy-error\" id=\"intestacy-name-error\"></div>\r\n    `;\r\n    content.appendChild(nameSection);\r\n    this.elements.nameSection = nameSection;\r\n    this.elements.nameInput = nameSection.querySelector('#intestacy-name');\r\n    this.elements.nameError = nameSection.querySelector('#intestacy-name-error');\r\n    \r\n    // Create estate value input\r\n    const estateSection = document.createElement('div');\r\n    estateSection.className = 'intestacy-section intestacy-estate-section';\r\n    estateSection.innerHTML = `\r\n      <label for=\"intestacy-estate\">What is the approximate value of your estate (£)?</label>\r\n      <input type=\"number\" id=\"intestacy-estate\" placeholder=\"Enter value in pounds\">\r\n      <div class=\"intestacy-error\" id=\"intestacy-estate-error\"></div>\r\n    `;\r\n    content.appendChild(estateSection);\r\n    this.elements.estateSection = estateSection;\r\n    this.elements.estateInput = estateSection.querySelector('#intestacy-estate');\r\n    this.elements.estateError = estateSection.querySelector('#intestacy-estate-error');\r\n    \r\n    // Create status input\r\n    const statusSection = document.createElement('div');\r\n    statusSection.className = 'intestacy-section intestacy-status-section';\r\n    statusSection.innerHTML = `\r\n      <label>What is your relationship status?</label>\r\n      <div class=\"intestacy-radio-group\">\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"single\"> Single\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"married\"> Married/Civil Partnership\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"cohabiting\"> Co-habiting\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"divorced\"> Divorced\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-status\" value=\"widowed\"> Widowed\r\n        </label>\r\n      </div>\r\n    `;\r\n    content.appendChild(statusSection);\r\n    this.elements.statusSection = statusSection;\r\n    this.elements.statusInputs = statusSection.querySelectorAll('input[name=\"intestacy-status\"]');\r\n    \r\n    // Create question section\r\n    const questionSection = document.createElement('div');\r\n    questionSection.className = 'intestacy-section intestacy-question-section';\r\n    questionSection.innerHTML = `\r\n      <div class=\"intestacy-question\" id=\"intestacy-question-text\"></div>\r\n      <div class=\"intestacy-radio-group\">\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-answer\" value=\"Yes\"> Yes\r\n        </label>\r\n        <label>\r\n          <input type=\"radio\" name=\"intestacy-answer\" value=\"No\"> No\r\n        </label>\r\n      </div>\r\n    `;\r\n    content.appendChild(questionSection);\r\n    this.elements.questionSection = questionSection;\r\n    this.elements.questionText = questionSection.querySelector('#intestacy-question-text');\r\n    this.elements.answerInputs = questionSection.querySelectorAll('input[name=\"intestacy-answer\"]');\r\n    \r\n    // Create result section\r\n    const resultSection = document.createElement('div');\r\n    resultSection.className = 'intestacy-section intestacy-result-section';\r\n    resultSection.innerHTML = `\r\n      <div class=\"intestacy-result\" id=\"intestacy-result\"></div>\r\n      <div class=\"intestacy-next-steps\">\r\n        <h2>What Next?</h2>\r\n        <p>Having a proper Will is the only way to ensure your estate is distributed according to your wishes.</p>\r\n        <div id=\"intestacy-contact-info\"></div>\r\n      </div>\r\n    `;\r\n    content.appendChild(resultSection);\r\n    this.elements.resultSection = resultSection;\r\n    this.elements.result = resultSection.querySelector('#intestacy-result');\r\n    this.elements.contactInfo = resultSection.querySelector('#intestacy-contact-info');\r\n    \r\n    // Create buttons\r\n    const buttonSection = document.createElement('div');\r\n    buttonSection.className = 'intestacy-buttons';\r\n    buttonSection.innerHTML = `\r\n      <button type=\"button\" id=\"intestacy-continue\">Continue</button>\r\n      <button type=\"button\" id=\"intestacy-restart\">Start Again</button>\r\n    `;\r\n    this.container.appendChild(buttonSection);\r\n    this.elements.continueButton = buttonSection.querySelector('#intestacy-continue');\r\n    this.elements.restartButton = buttonSection.querySelector('#intestacy-restart');\r\n    \r\n    // Create footer\r\n    const footer = document.createElement('div');\r\n    footer.className = 'intestacy-footer';\r\n    footer.innerHTML = `\r\n      <p><strong>Legal Disclaimer:</strong> This calculator provides guidance based on UK intestacy rules. \r\n      For legal advice, please consult a qualified professional.</p>\r\n    `;\r\n    this.container.appendChild(footer);\r\n    \r\n    // Hide sections initially\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n  }\r\n  \r\n  /**\r\n   * Add event listeners to UI elements\r\n   */\r\n  addEventListeners() {\r\n    // Continue button\r\n    this.elements.continueButton.addEventListener('click', () => {\r\n      this.handleContinue();\r\n    });\r\n    \r\n    // Restart button\r\n    this.elements.restartButton.addEventListener('click', () => {\r\n      this.handleRestart();\r\n    });\r\n    \r\n    // Name input enter key\r\n    this.elements.nameInput.addEventListener('keypress', (event) => {\r\n      if (event.key === 'Enter') {\r\n        this.handleContinue();\r\n      }\r\n    });\r\n    \r\n    // Estate input enter key\r\n    this.elements.estateInput.addEventListener('keypress', (event) => {\r\n      if (event.key === 'Enter') {\r\n        this.handleContinue();\r\n      }\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Apply the selected theme\r\n   */\r\n  applyTheme() {\r\n    this.container.classList.add(`intestacy-theme-${this.options.theme}`);\r\n  }\r\n  \r\n  /**\r\n   * Show the name input step\r\n   */\r\n  showNameInput() {\r\n    // Update state\r\n    this.state.currentStep = 'name';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'block';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n    \r\n    // Focus on input\r\n    this.elements.nameInput.focus();\r\n  }\r\n  \r\n  /**\r\n   * Show the estate value input step\r\n   */\r\n  showEstateInput() {\r\n    // Update state\r\n    this.state.currentStep = 'estate';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'block';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n    \r\n    // Focus on input\r\n    this.elements.estateInput.focus();\r\n  }\r\n  \r\n  /**\r\n   * Show the relationship status input step\r\n   */\r\n  showStatusInput() {\r\n    // Update state\r\n    this.state.currentStep = 'status';\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'block';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'none';\r\n  }\r\n  \r\n  /**\r\n   * Show a question\r\n   * @param {string} questionId - The ID of the question to show\r\n   */\r\n  showQuestion(questionId) {\r\n    // Update state\r\n    this.state.currentStep = 'question';\r\n    this.state.questionId = questionId;\r\n    \r\n    // Update question text\r\n    this.elements.questionText.textContent = this.calculator.getQuestionText(questionId);\r\n    \r\n    // Clear previous answer\r\n    this.elements.answerInputs.forEach(input => {\r\n      input.checked = false;\r\n    });\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'block';\r\n    this.elements.resultSection.style.display = 'none';\r\n    \r\n    // Ensure cohabiting warning remains visible if applicable\r\n    if (this.calculator.state.cohabiting) {\r\n      this.elements.cohabitingWarning.style.display = 'block';\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Show the result\r\n   */\r\n  showResult() {\r\n    // Calculate distribution\r\n    const resultText = this.calculator.calculateDistribution();\r\n    \r\n    // Format result with name\r\n    const formattedResult = `\r\n      <h2>Distribution Results for ${this.state.name}</h2>\r\n      <p>${resultText}</p>\r\n      <p>If you wish to change this distribution, you will need to create a Will.</p>\r\n    `;\r\n    \r\n    // Update result text\r\n    this.elements.result.innerHTML = formattedResult;\r\n    \r\n    // Update contact info\r\n    if (this.calculator.state.cohabiting) {\r\n      // Enhanced contact info for cohabiting partners\r\n      this.elements.contactInfo.innerHTML = `\r\n        <strong>URGENT:</strong> As a cohabiting partner, creating a Will is essential to protect your partner.\r\n        <br>Contact our firm at <strong>0123 456 7890</strong> or <strong>info@example.com</strong> to discuss creating a Will.\r\n      `;\r\n      \r\n      // Ensure cohabiting warning remains visible\r\n      this.elements.cohabitingWarning.style.display = 'block';\r\n    } else {\r\n      this.elements.contactInfo.textContent = this.options.contactInfo;\r\n    }\r\n    \r\n    // Show/hide sections\r\n    this.elements.nameSection.style.display = 'none';\r\n    this.elements.estateSection.style.display = 'none';\r\n    this.elements.statusSection.style.display = 'none';\r\n    this.elements.questionSection.style.display = 'none';\r\n    this.elements.resultSection.style.display = 'block';\r\n  }\r\n  \r\n  /**\r\n   * Handle the continue button click\r\n   */\r\n  handleContinue() {\r\n    switch (this.state.currentStep) {\r\n      case 'name':\r\n        this.handleNameSubmit();\r\n        break;\r\n      case 'estate':\r\n        this.handleEstateSubmit();\r\n        break;\r\n      case 'status':\r\n        this.handleStatusSubmit();\r\n        break;\r\n      case 'question':\r\n        this.handleQuestionAnswer();\r\n        break;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Handle name input submission\r\n   */\r\n  handleNameSubmit() {\r\n    const name = this.elements.nameInput.value;\r\n    const validation = validateName(name);\r\n    \r\n    if (!validation.isValid) {\r\n      this.elements.nameError.textContent = validation.errorMessage;\r\n      return;\r\n    }\r\n    \r\n    // Clear error\r\n    this.elements.nameError.textContent = '';\r\n    \r\n    // Update state\r\n    this.state.name = name;\r\n    \r\n    // Move to next step\r\n    this.showEstateInput();\r\n  }\r\n  \r\n  /**\r\n   * Handle estate value input submission\r\n   */\r\n  handleEstateSubmit() {\r\n    const estateValue = this.elements.estateInput.value;\r\n    const validation = validateEstateValue(estateValue);\r\n    \r\n    if (!validation.isValid) {\r\n      this.elements.estateError.textContent = validation.errorMessage;\r\n      return;\r\n    }\r\n    \r\n    // Clear error\r\n    this.elements.estateError.textContent = '';\r\n    \r\n    // Update state\r\n    this.state.estateValue = parseFloat(estateValue);\r\n    \r\n    // Move to next step\r\n    this.showStatusInput();\r\n  }\r\n  \r\n  /**\r\n   * Handle relationship status submission\r\n   */\r\n  handleStatusSubmit() {\r\n    let selectedStatus = null;\r\n    \r\n    // Find selected status\r\n    this.elements.statusInputs.forEach(input => {\r\n      if (input.checked) {\r\n        selectedStatus = input.value;\r\n      }\r\n    });\r\n    \r\n    if (!selectedStatus) {\r\n      return; // No status selected\r\n    }\r\n    \r\n    // Update calculator state\r\n    this.calculator.state.name = this.state.name;\r\n    this.calculator.state.estateValue = this.state.estateValue;\r\n    this.calculator.state.married = (selectedStatus === 'married');\r\n    this.calculator.state.cohabiting = (selectedStatus === 'cohabiting');\r\n    \r\n    // Show or hide cohabiting warning\r\n    if (selectedStatus === 'cohabiting') {\r\n      this.elements.cohabitingWarning.style.display = 'block';\r\n    } else {\r\n      this.elements.cohabitingWarning.style.display = 'none';\r\n    }\r\n    \r\n    // Start the question flow\r\n    this.showQuestion('children');\r\n  }\r\n  \r\n  /**\r\n   * Handle question answer\r\n   */\r\n  handleQuestionAnswer() {\r\n    let selectedAnswer = null;\r\n    \r\n    // Find selected answer\r\n    this.elements.answerInputs.forEach(input => {\r\n      if (input.checked) {\r\n        selectedAnswer = input.value;\r\n      }\r\n    });\r\n    \r\n    if (!selectedAnswer) {\r\n      return; // No answer selected\r\n    }\r\n    \r\n    const questionId = this.state.questionId;\r\n    const isYes = (selectedAnswer === 'Yes');\r\n    \r\n    // Update the calculator state with this answer\r\n    this.calculator.state[questionId] = isYes;\r\n    \r\n    // Process the answer and get the next question\r\n    const nextQuestionId = this.calculator.processAnswer(questionId, isYes);\r\n    \r\n    // If we have a next question, show it\r\n    if (nextQuestionId) {\r\n      this.showQuestion(nextQuestionId);\r\n    } else {\r\n      // Otherwise, we have enough information to show the result\r\n      this.showResult();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Handle restart button click\r\n   */\r\n  handleRestart() {\r\n    // Reset calculator\r\n    this.calculator = new IntestacyCalculator();\r\n    \r\n    // Reset state\r\n    this.state = {\r\n      currentStep: 'name',\r\n      questionId: null,\r\n      name: '',\r\n      estateValue: null\r\n    };\r\n    \r\n    // Reset inputs\r\n    this.elements.nameInput.value = '';\r\n    this.elements.estateInput.value = '';\r\n    this.elements.nameError.textContent = '';\r\n    this.elements.estateError.textContent = '';\r\n    \r\n    this.elements.statusInputs.forEach(input => {\r\n      input.checked = false;\r\n    });\r\n    \r\n    // Hide cohabiting warning\r\n    this.elements.cohabitingWarning.style.display = 'none';\r\n    \r\n    // Show first step\r\n    this.showNameInput();\r\n  }\r\n}\r\n\r\n// Export the class for use in other modules\r\nexport default IntestacyUI;","/**\r\n * IntestacyWidget.js\r\n * Main widget for embedding the intestacy calculator\r\n */\r\n\r\nimport IntestacyUI from '../ui/IntestacyUI.js';\r\n\r\nclass IntestacyWidget {\r\n  /**\r\n   * Create a new IntestacyWidget instance\r\n   * @param {Object} options - Configuration options\r\n   */\r\n  constructor(options = {}) {\r\n    // Default options\r\n    this.options = {\r\n      container: '#intestacy-calculator',\r\n      theme: 'light',\r\n      contactInfo: 'Please contact us to discuss creating a Will.',\r\n      contactPhone: '0123 456 7890',\r\n      contactEmail: 'info@example.com',\r\n      ...options\r\n    };\r\n    \r\n    // Initialize the widget\r\n    this.init();\r\n  }\r\n  \r\n  /**\r\n   * Initialize the widget\r\n   */\r\n  init() {\r\n    // Ensure styles are loaded\r\n    this.loadStyles();\r\n    \r\n    // Initialize UI\r\n    this.ui = new IntestacyUI(\r\n      this.options.container,\r\n      {\r\n        theme: this.options.theme,\r\n        contactInfo: this.options.contactInfo,\r\n        contactPhone: this.options.contactPhone,\r\n        contactEmail: this.options.contactEmail\r\n      }\r\n    );\r\n  }\r\n  \r\n  /**\r\n   * Load the required styles\r\n   */\r\n  loadStyles() {\r\n    // Check if styles are already loaded\r\n    if (document.getElementById('intestacy-calculator-styles')) {\r\n      return;\r\n    }\r\n    \r\n    // Create style element\r\n    const style = document.createElement('style');\r\n    style.id = 'intestacy-calculator-styles';\r\n    style.textContent = this.getStyles();\r\n    \r\n    // Append to head\r\n    document.head.appendChild(style);\r\n  }\r\n  \r\n  /**\r\n   * Get the CSS styles as a string\r\n   * @returns {string} - CSS styles\r\n   */\r\n  getStyles() {\r\n    return `\r\n      /**\r\n       * Intestacy Calculator Styles\r\n       */\r\n      \r\n      /* Base styles */\r\n      .intestacy-calculator {\r\n        font-family: Arial, sans-serif;\r\n        max-width: 800px;\r\n        margin: 0 auto;\r\n        padding: 20px;\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      .intestacy-calculator * {\r\n        box-sizing: border-box;\r\n      }\r\n      \r\n      /* Cohabiting warning styles */\r\n      .intestacy-cohabiting-warning {\r\n        background-color: #ffebee;\r\n        border: 2px solid #f44336;\r\n        color: #c62828;\r\n        padding: 20px;\r\n        margin: 20px 0;\r\n        border-radius: 6px;\r\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n        position: relative;\r\n        overflow: hidden;\r\n        animation: pulse 2s infinite;\r\n      }\r\n      \r\n      @keyframes pulse {\r\n        0% {\r\n          box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);\r\n        }\r\n        70% {\r\n          box-shadow: 0 0 0 10px rgba(244, 67, 54, 0);\r\n        }\r\n        100% {\r\n          box-shadow: 0 0 0 0 rgba(244, 67, 54, 0);\r\n        }\r\n      }\r\n      \r\n      /* Add a left border accent for visual emphasis */\r\n      .intestacy-cohabiting-warning::before {\r\n        content: \"\";\r\n        position: absolute;\r\n        left: 0;\r\n        top: 0;\r\n        bottom: 0;\r\n        width: 6px;\r\n        background-color: #d32f2f;\r\n      }\r\n      \r\n      .intestacy-cohabiting-warning strong:first-child {\r\n        display: block;\r\n        font-size: 18px;\r\n        margin-bottom: 10px;\r\n        color: #d32f2f;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.5px;\r\n      }\r\n      \r\n      .intestacy-cohabiting-warning p {\r\n        margin: 10px 0;\r\n        line-height: 1.5;\r\n        font-size: 15px;\r\n      }\r\n      \r\n      .intestacy-contact-highlight {\r\n        background-color: rgba(255, 255, 255, 0.7);\r\n        padding: 12px;\r\n        border-radius: 4px;\r\n        margin-top: 12px;\r\n        font-weight: bold;\r\n        border-left: 3px solid #d32f2f;\r\n      }\r\n      \r\n      .intestacy-contact-highlight strong {\r\n        color: #d32f2f;\r\n      }\r\n      \r\n      /* Header */\r\n      .intestacy-header {\r\n        margin-bottom: 30px;\r\n        text-align: center;\r\n      }\r\n      \r\n      .intestacy-header h1 {\r\n        font-size: 28px;\r\n        margin: 0 0 10px 0;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-header p {\r\n        font-size: 16px;\r\n        margin: 0;\r\n        color: #666;\r\n      }\r\n      \r\n      /* Content sections */\r\n      .intestacy-content {\r\n        background-color: #f9f9f9;\r\n        border-radius: 8px;\r\n        padding: 20px;\r\n        margin-bottom: 20px;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n      }\r\n      \r\n      .intestacy-section {\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      /* Form elements */\r\n      .intestacy-calculator label {\r\n        display: block;\r\n        font-size: 16px;\r\n        font-weight: bold;\r\n        margin-bottom: 8px;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-calculator input[type=\"text\"],\r\n      .intestacy-calculator input[type=\"number\"] {\r\n        width: 100%;\r\n        padding: 10px;\r\n        font-size: 16px;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n        margin-bottom: 5px;\r\n      }\r\n      \r\n      .intestacy-calculator input[type=\"text\"]:focus,\r\n      .intestacy-calculator input[type=\"number\"]:focus {\r\n        border-color: #007bff;\r\n        outline: none;\r\n        box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);\r\n      }\r\n      \r\n      /* Radio buttons */\r\n      .intestacy-radio-group {\r\n        margin-top: 10px;\r\n      }\r\n      \r\n      .intestacy-radio-group label {\r\n        display: block;\r\n        font-weight: normal;\r\n        margin-bottom: 10px;\r\n        cursor: pointer;\r\n      }\r\n      \r\n      .intestacy-radio-group input[type=\"radio\"] {\r\n        margin-right: 8px;\r\n      }\r\n      \r\n      /* Error messages */\r\n      .intestacy-error {\r\n        color: #dc3545;\r\n        font-size: 14px;\r\n        margin-top: 5px;\r\n        min-height: 20px;\r\n      }\r\n      \r\n      /* Question section */\r\n      .intestacy-question {\r\n        font-size: 18px;\r\n        margin-bottom: 15px;\r\n        color: #333;\r\n      }\r\n      \r\n      /* Result section */\r\n      .intestacy-result {\r\n        background-color: #fff;\r\n        padding: 20px;\r\n        border-radius: 5px;\r\n        margin-bottom: 20px;\r\n        border-left: 4px solid #007bff;\r\n      }\r\n      \r\n      .intestacy-result h2 {\r\n        font-size: 22px;\r\n        margin-top: 0;\r\n        margin-bottom: 15px;\r\n        color: #333;\r\n      }\r\n      \r\n      .intestacy-result p {\r\n        margin-bottom: 15px;\r\n        line-height: 1.5;\r\n      }\r\n      \r\n      .intestacy-next-steps {\r\n        margin-top: 20px;\r\n      }\r\n      \r\n      .intestacy-next-steps h2 {\r\n        font-size: 20px;\r\n        margin-top: 0;\r\n        margin-bottom: 10px;\r\n        color: #333;\r\n      }\r\n      \r\n      /* Buttons */\r\n      .intestacy-buttons {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        margin-bottom: 20px;\r\n      }\r\n      \r\n      .intestacy-calculator button {\r\n        padding: 10px 20px;\r\n        font-size: 16px;\r\n        border: none;\r\n        border-radius: 4px;\r\n        cursor: pointer;\r\n        transition: background-color 0.2s;\r\n      }\r\n      \r\n      #intestacy-continue {\r\n        background-color: #007bff;\r\n        color: white;\r\n      }\r\n      \r\n      #intestacy-continue:hover {\r\n        background-color: #0069d9;\r\n      }\r\n      \r\n      #intestacy-restart {\r\n        background-color: #6c757d;\r\n        color: white;\r\n      }\r\n      \r\n      #intestacy-restart:hover {\r\n        background-color: #5a6268;\r\n      }\r\n      \r\n      /* Footer */\r\n      .intestacy-footer {\r\n        font-size: 14px;\r\n        color: #666;\r\n        text-align: center;\r\n        margin-top: 30px;\r\n        padding-top: 15px;\r\n        border-top: 1px solid #eee;\r\n      }\r\n      \r\n      /* Light theme (default) */\r\n      .intestacy-theme-light {\r\n        /* Default styles are already light theme */\r\n      }\r\n      \r\n      /* Dark theme */\r\n      .intestacy-theme-dark {\r\n        background-color: #333;\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-header h1 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-header p {\r\n        color: #ccc;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-content {\r\n        background-color: #444;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-calculator label {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-calculator input[type=\"text\"],\r\n      .intestacy-theme-dark .intestacy-calculator input[type=\"number\"] {\r\n        background-color: #555;\r\n        border-color: #666;\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-question {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-result {\r\n        background-color: #555;\r\n        border-left-color: #0d6efd;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-result h2 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-next-steps h2 {\r\n        color: #f5f5f5;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-footer {\r\n        color: #ccc;\r\n        border-top-color: #555;\r\n      }\r\n      \r\n      /* Dark theme adjustments for cohabiting warning */\r\n      .intestacy-theme-dark .intestacy-cohabiting-warning {\r\n        background-color: rgba(244, 67, 54, 0.15);\r\n        border-color: #f44336;\r\n        color: #ff8a80;\r\n      }\r\n      \r\n      .intestacy-theme-dark .intestacy-contact-highlight {\r\n        background-color: rgba(0, 0, 0, 0.3);\r\n        color: #fff;\r\n      }\r\n      \r\n      /* Responsive styles */\r\n      @media (max-width: 768px) {\r\n        .intestacy-calculator {\r\n          padding: 15px;\r\n        }\r\n        \r\n        .intestacy-header h1 {\r\n          font-size: 24px;\r\n        }\r\n        \r\n        .intestacy-content {\r\n          padding: 15px;\r\n        }\r\n        \r\n        .intestacy-buttons {\r\n          flex-direction: column;\r\n          gap: 10px;\r\n        }\r\n        \r\n        .intestacy-calculator button {\r\n          width: 100%;\r\n        }\r\n      }\r\n      \r\n      @media (max-width: 480px) {\r\n        .intestacy-header h1 {\r\n          font-size: 22px;\r\n        }\r\n        \r\n        .intestacy-question {\r\n          font-size: 16px;\r\n        }\r\n        \r\n        .intestacy-result h2 {\r\n          font-size: 20px;\r\n        }\r\n      }\r\n    `;\r\n  }\r\n  \r\n  /**\r\n   * Reset the calculator to its initial state\r\n   */\r\n  reset() {\r\n    if (this.ui) {\r\n      this.ui.handleRestart();\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * Update widget options\r\n   * @param {Object} options - New options to apply\r\n   */\r\n  updateOptions(options = {}) {\r\n    this.options = {\r\n      ...this.options,\r\n      ...options\r\n    };\r\n    \r\n    // Reinitialize with new options\r\n    this.init();\r\n  }\r\n}\r\n\r\n// Make available globally when included via script tag\r\nif (typeof window !== 'undefined') {\r\n  window.IntestacyWidget = IntestacyWidget;\r\n}\r\n\r\nexport default IntestacyWidget;"],"names":["IntestacyCalculator","constructor","STATUTORY_LEGACY","state","name","estateValue","married","cohabiting","children","grandchildren","greatGrandchildren","parentsAlive","siblings","fullSiblings","halfSiblings","grandparents","auntsUncles","fullAuntsUncles","halfAuntsUncles","currentQuestion","childrenDeceased","deceasedChildrenHadChildren","siblingsDeceasedWithChildren","auntsUnclesDeceasedWithChildren","questions","id","text","questionMap","createQuestionMap","questionFlow","defineQuestionFlow","map","forEach","question","answer","validateEstateValue","value","undefined","isValid","errorMessage","parseFloat","isNaN","error","formatCurrency","amount","Intl","NumberFormat","style","currency","format","calculateDistribution","formattedValue","getInheritanceHierarchyText","remainder","spouseShare","childrenShare","childrenText","siblingType","auntsText","processAnswer","questionId","nextQuestionId","getQuestionText","canDetermineDistribution","some","condition","numValue","validateName","trim","length","IntestacyUI","container","options","document","querySelector","Error","theme","contactInfo","calculator","currentStep","elements","init","createUIStructure","addEventListeners","applyTheme","showNameInput","innerHTML","classList","add","contactPhone","contactEmail","header","createElement","className","appendChild","cohabitingWarning","display","content","nameSection","nameInput","nameError","estateSection","estateInput","estateError","statusSection","statusInputs","querySelectorAll","questionSection","questionText","answerInputs","resultSection","result","buttonSection","continueButton","restartButton","footer","addEventListener","handleContinue","handleRestart","event","key","focus","showEstateInput","showStatusInput","showQuestion","textContent","input","checked","showResult","resultText","formattedResult","handleNameSubmit","handleEstateSubmit","handleStatusSubmit","handleQuestionAnswer","validation","selectedStatus","selectedAnswer","isYes","IntestacyWidget","loadStyles","ui","getElementById","getStyles","head","reset","updateOptions","window"],"mappings":"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EAAE,IAAI,CAACJ,OAAO,CAACI,KAAK;EACzBC,MAAAA,WAAW,EAAE,IAAI,CAACL,OAAO,CAACK,WAAW;EACrCY,MAAAA,YAAY,EAAE,IAAI,CAACjB,OAAO,CAACiB,YAAY;EACvCC,MAAAA,YAAY,EAAE,IAAI,CAAClB,OAAO,CAACkB,YAAAA;EAC7B,KACF,CAAC,CAAA;EACH,GAAA;;EAEA;EACF;EACA;EACEkD,EAAAA,UAAUA,GAAG;EACX;EACA,IAAA,IAAInE,QAAQ,CAACqE,cAAc,CAAC,6BAA6B,CAAC,EAAE;EAC1D,MAAA,OAAA;EACF,KAAA;;EAEA;EACA,IAAA,MAAM/F,KAAK,GAAG0B,QAAQ,CAACmB,aAAa,CAAC,OAAO,CAAC,CAAA;MAC7C7C,KAAK,CAACtB,EAAE,GAAG,6BAA6B,CAAA;EACxCsB,IAAAA,KAAK,CAAC8E,WAAW,GAAG,IAAI,CAACkB,SAAS,EAAE,CAAA;;EAEpC;EACAtE,IAAAA,QAAQ,CAACuE,IAAI,CAAClD,WAAW,CAAC/C,KAAK,CAAC,CAAA;EAClC,GAAA;;EAEA;EACF;EACA;EACA;EACEgG,EAAAA,SAASA,GAAG;MACV,OAAO,CAAA;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAK,CAAA,CAAA;EACH,GAAA;;EAEA;EACF;EACA;EACEE,EAAAA,KAAKA,GAAG;MACN,IAAI,IAAI,CAACJ,EAAE,EAAE;EACX,MAAA,IAAI,CAACA,EAAE,CAACvB,aAAa,EAAE,CAAA;EACzB,KAAA;EACF,GAAA;;EAEA;EACF;EACA;EACA;EACE4B,EAAAA,aAAaA,CAAC1E,OAAO,GAAG,EAAE,EAAE;MAC1B,IAAI,CAACA,OAAO,GAAG;QACb,GAAG,IAAI,CAACA,OAAO;QACf,GAAGA,OAAAA;OACJ,CAAA;;EAED;MACA,IAAI,CAACS,IAAI,EAAE,CAAA;EACb,GAAA;EACF,CAAA;;EAEA;EACA,IAAI,OAAOkE,MAAM,KAAK,WAAW,EAAE;IACjCA,MAAM,CAACR,eAAe,GAAGA,eAAe,CAAA;EAC1C;;;;;;;;"}